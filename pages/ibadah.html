<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Ibadah - Sync Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
  <link rel="stylesheet" href="../css/layout.css">
  <link rel="stylesheet" href="../css/features.css">
</head>
<body>
  <header class="header" id="appHeader"></header>
  <main class="main" id="mainContent"></main>
  <nav class="bottom-nav" id="bottomNav"></nav>

  <script src="../js/data.js"></script>
  <script src="../js/app.js"></script>
  <script>
    let activeTab = 'sholat';
    let dzikirTime = 'pagi';
    
    function render() {
      const main = document.getElementById('mainContent');
      const sholat = loadSholat();
      const dzikir = loadDzikir();
      
      main.innerHTML = `
        <!-- Tabs -->
        <div class="tabs mb-3">
          <button class="tab-btn ${activeTab==='sholat'?'active':''}" onclick="setTab('sholat')">ğŸ•Œ Sholat</button>
          <button class="tab-btn ${activeTab==='dzikir'?'active':''}" onclick="setTab('dzikir')">ğŸ“¿ Dzikir</button>
        </div>
        
        ${activeTab === 'sholat' ? renderSholatTab(sholat) : renderDzikirTab(dzikir)}
      `;
    }
    
    function renderSholatTab(sholat) {
      const sholatDone = Object.values(sholat).filter(s => s?.done).length;
      
      return `
        <div class="card mb-3" style="background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border:none;">
          <div style="text-align:center;">
            <div style="font-size:32px;font-weight:700;color:#2e7d32;">${sholatDone}/8</div>
            <div style="font-size:13px;color:#558b2f;">Sholat hari ini</div>
          </div>
        </div>
        
        <div class="sholat-container">
          ${SHOLAT_LIST.map(s => `
            <div class="sholat-item ${sholat[s.id]?.done?'done':''}" onclick="toggleSholat('${s.id}'); render();">
              <div class="icon">${s.icon}</div>
              <div class="name">${s.name}</div>
              <div class="time">${s.fardhu?'Fardhu':'Sunnah'}</div>
              ${sholat[s.id]?.done ? '<div style="color:#2e7d32;font-size:18px;margin-top:4px;">âœ“</div>' : ''}
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function renderDzikirTab(dzikir) {
      const list = dzikirTime === 'pagi' ? DZIKIR_PAGI : DZIKIR_SORE;
      const progress = dzikir[dzikirTime] || {};
      const completed = list.filter(d => (progress[d.id] || 0) >= d.count).length;
      
      return `
        <div class="card mb-3" style="background:linear-gradient(135deg,#e3f2fd,#bbdefb);border:none;">
          <div style="text-align:center;">
            <div style="font-size:32px;font-weight:700;color:#1976d2;">${completed}/${list.length}</div>
            <div style="font-size:13px;color:#1565c0;">Dzikir ${dzikirTime}</div>
          </div>
        </div>
        
        <div class="dzikir-time-toggle">
          <button class="dzikir-time-btn ${dzikirTime==='pagi'?'active':''}" onclick="setDzikirTime('pagi')">â˜€ï¸ Pagi</button>
          <button class="dzikir-time-btn ${dzikirTime==='sore'?'active':''}" onclick="setDzikirTime('sore')">ğŸŒ… Sore</button>
        </div>
        
        <div class="dzikir-list">
          ${list.map(d => {
            const count = progress[d.id] || 0;
            const done = count >= d.count;
            return `
              <div class="dzikir-item ${done?'completed':''}" onclick="openDzikir('${d.id}')">
                <div class="dzikir-item-icon">${done?'âœ“':'ğŸ“¿'}</div>
                <div class="dzikir-item-content">
                  <div class="dzikir-item-title">${d.latin.substring(0, 35)}...</div>
                  <div class="dzikir-item-count">${d.count}x â€¢ ${d.virtue}</div>
                </div>
                <div class="dzikir-item-progress">
                  <div class="dzikir-item-progress-text">${count}/${d.count}</div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }
    
    function setTab(tab) {
      activeTab = tab;
      render();
    }
    
    function setDzikirTime(time) {
      dzikirTime = time;
      render();
    }
    
    function openDzikir(id) {
      const list = dzikirTime === 'pagi' ? DZIKIR_PAGI : DZIKIR_SORE;
      const d = list.find(x => x.id === id);
      if (!d) return;
      
      const dzikir = loadDzikir();
      const progress = dzikir[dzikirTime] || {};
      const count = progress[d.id] || 0;
      
      // Create fullscreen counter
      const fs = document.createElement('div');
      fs.className = 'dzikir-fullscreen active';
      fs.innerHTML = `
        <div class="dzikir-fs-header">
          <button class="dzikir-fs-back" onclick="closeDzikir()">â† Kembali</button>
          <div class="dzikir-fs-title">${d.count}x</div>
        </div>
        <div class="dzikir-fs-content">
          <div class="dzikir-fs-arabic" style="font-family:'Amiri',serif;">${d.arabic}</div>
          <div class="dzikir-fs-latin">${d.latin}</div>
          <div class="dzikir-fs-meaning">${d.meaning}</div>
          <div class="dzikir-fs-counter">
            <div class="dzikir-fs-circle ${count >= d.count ? 'completed' : ''}" onclick="incrementDzikir('${id}', ${d.count})">
              <div class="dzikir-fs-count" id="dzikirCount">${count}</div>
              <div class="dzikir-fs-target">/ ${d.count}</div>
            </div>
          </div>
          <p style="margin-top:16px;font-size:12px;opacity:0.7;">Tap lingkaran untuk menghitung</p>
        </div>
      `;
      document.body.appendChild(fs);
    }
    
    function closeDzikir() {
      document.querySelector('.dzikir-fullscreen')?.remove();
      render();
    }
    
    function incrementDzikir(id, target) {
      const dzikir = loadDzikir();
      if (!dzikir[dzikirTime]) dzikir[dzikirTime] = {};
      const current = dzikir[dzikirTime][id] || 0;
      
      if (current < target) {
        dzikir[dzikirTime][id] = current + 1;
        Storage.saveToday('dzikir', dzikir);
        
        const countEl = document.getElementById('dzikirCount');
        if (countEl) countEl.textContent = current + 1;
        
        if (current + 1 >= target) {
          document.querySelector('.dzikir-fs-circle')?.classList.add('completed');
          showToast('âœ“ Alhamdulillah, selesai!', 'success');
        }
      }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      renderHeader({ simple: true, title: 'ğŸ•Œ Ibadah' });
      renderBottomNav();
      render();
    });
  </script>
</body>
</html>
