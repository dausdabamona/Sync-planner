<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Tasks - Sync Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
  <link rel="stylesheet" href="../css/layout.css">
  <link rel="stylesheet" href="../css/features.css">
</head>
<body>
  <header class="header" id="appHeader"></header>
  <main class="main" id="mainContent"></main>
  <nav class="bottom-nav" id="bottomNav"></nav>

  <script src="../js/data.js"></script>
  <script src="../js/app.js"></script>
  <script>
    let viewMode = 'list'; // list or kanban
    
    function renderTasks() {
      const main = document.getElementById('mainContent');
      const tasks = loadTasks();
      
      main.innerHTML = `
        <div class="page-header">
          <h2 class="page-title">âœ… Tasks</h2>
        </div>
        
        <div class="toggle mb-3">
          <button class="toggle-btn ${viewMode==='list'?'active':''}" onclick="setView('list')">ğŸ“‹ List</button>
          <button class="toggle-btn ${viewMode==='kanban'?'active':''}" onclick="setView('kanban')">ğŸ“Š Kanban</button>
        </div>
        
        <button class="btn btn-primary btn-full mb-3" onclick="showAddTask()">â• Tambah Task</button>
        
        <div id="tasksView">
          ${viewMode === 'list' ? renderListView(tasks) : renderKanbanView(tasks)}
        </div>
      `;
    }
    
    function renderListView(tasks) {
      if (!tasks.length) return '<div class="empty-state"><div class="icon">ğŸ“</div><p>Belum ada task</p></div>';
      
      return `
        <div class="tabs mb-3">
          <button class="tab-btn active" onclick="filterTasks('all')">Semua (${tasks.length})</button>
          <button class="tab-btn" onclick="filterTasks('todo')">To Do (${tasks.filter(t=>!t.done).length})</button>
          <button class="tab-btn" onclick="filterTasks('done')">Selesai (${tasks.filter(t=>t.done).length})</button>
        </div>
        <div class="task-list">
          ${tasks.map(t => `
            <div class="task-item priority-${t.priority||'medium'}">
              <div class="task-checkbox ${t.done?'checked':''}" onclick="toggleTask('${t.id}')">${t.done?'âœ“':''}</div>
              <div class="task-content">
                <div class="task-title ${t.done?'completed':''}">${t.title}</div>
                <div class="task-meta"><span class="task-tag">${t.priority||'medium'}</span></div>
              </div>
              <div class="task-actions">
                <button class="task-action-btn" onclick="deleteTask('${t.id}')">ğŸ—‘ï¸</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function renderKanbanView(tasks) {
      const columns = [
        { id: 'backlog', name: 'Backlog', icon: 'ğŸ“¥' },
        { id: 'todo', name: 'To Do', icon: 'ğŸ“‹' },
        { id: 'progress', name: 'In Progress', icon: 'ğŸ”„' },
        { id: 'done', name: 'Done', icon: 'âœ…' }
      ];
      
      return `
        <div class="kanban-container">
          ${columns.map(col => `
            <div class="kanban-column">
              <div class="kanban-column-header">
                ${col.icon} ${col.name}
                <span class="count">${tasks.filter(t => (t.status||'todo') === col.id).length}</span>
              </div>
              ${tasks.filter(t => (t.status||'todo') === col.id).map(t => `
                <div class="kanban-task" onclick="moveTaskForward('${t.id}')">
                  <div class="title">${t.title}</div>
                  <div class="meta">
                    <span class="priority" style="background:${t.priority==='high'?'#ff6b6b':t.priority==='low'?'#4caf50':'#ffa500'}"></span>
                  </div>
                </div>
              `).join('')}
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function setView(mode) {
      viewMode = mode;
      renderTasks();
    }
    
    function moveTaskForward(id) {
      const tasks = loadTasks();
      const task = tasks.find(t => t.id === id);
      if (task) {
        const cols = ['backlog', 'todo', 'progress', 'done'];
        const idx = cols.indexOf(task.status || 'todo');
        task.status = cols[(idx + 1) % cols.length];
        task.done = task.status === 'done';
        Storage.save('tasks', tasks);
        renderTasks();
      }
    }
    
    function deleteTask(id) {
      if (!confirm('Hapus task ini?')) return;
      let tasks = loadTasks();
      tasks = tasks.filter(t => t.id !== id);
      Storage.save('tasks', tasks);
      renderTasks();
      showToast('Task dihapus', 'success');
    }
    
    function filterTasks(filter) {
      // Simple filter implementation
      const allBtns = document.querySelectorAll('.tabs .tab-btn');
      allBtns.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }
    
    // Override saveNewTask to refresh this page
    const originalSaveNewTask = saveNewTask;
    saveNewTask = function() {
      const title = document.getElementById('taskTitle')?.value.trim();
      if (!title) { showToast('Judul tidak boleh kosong', 'error'); return; }
      const tasks = loadTasks();
      tasks.push({ id: generateId(), title, priority: document.getElementById('taskPriority').value, done: false, status: 'todo', createdAt: new Date().toISOString() });
      Storage.save('tasks', tasks);
      closeModal();
      showToast('âœ“ Task ditambahkan', 'success');
      renderTasks();
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      renderHeader({ simple: true, title: 'âœ… Tasks' });
      renderBottomNav('tasks');
      renderTasks();
    });
  </script>
</body>
</html>
