<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0D47A1">
  <meta name="description" content="Sync Planner - Produktivitas Islami">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Sync Planner</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
  <div class="app-container">
    
    <!-- ============================================ -->
    <!-- HEADER -->
    <!-- ============================================ -->
    <header class="header">
      <div class="header-top">
        <h1>ğŸŒ™ Sync Planner</h1>
        <div class="header-actions">
          <button class="header-btn" onclick="location.reload()">ğŸ”„</button>
        </div>
      </div>
      <div class="header-stats">
        <div class="stat-item">
          âœ… <span class="value" id="headerTasks">0</span>
        </div>
        <div class="stat-item">
          ğŸ… <span class="value" id="headerPomodoro">0</span>
        </div>
        <div class="stat-item">
          ğŸ”¥ <span class="value" id="headerHabits">0</span>
        </div>
        <div class="stat-item clickable" onclick="openBreakSettingsModal()">
          ğŸ§˜ <span class="value" id="breakStreak">0ğŸ”¥</span>
        </div>
      </div>
    </header>

    <!-- ============================================ -->
    <!-- MAIN CONTENT -->
    <!-- ============================================ -->
    <main class="main-content">
      
      <!-- HOME PAGE -->
      <div class="page active" id="page-home">
        <!-- Date -->
        <div class="card" style="text-align:center;padding:12px;">
          <div id="currentDate" style="font-size:14px;color:#666;"></div>
        </div>
        
        <!-- Wisdom Card -->
        <div class="card wisdom-card" id="wisdomCard"></div>
        
        <!-- Habits -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ”¥ Habit Harian</span>
          </div>
          <div class="habit-grid" id="habitsContainer"></div>
        </div>
        
        <!-- Today's Tasks Preview -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“‹ Tugas Hari Ini</span>
            <button class="btn btn-sm btn-primary" onclick="showPage('tasks')">Lihat Semua</button>
          </div>
          <div id="todayTasks"></div>
        </div>
        
        <!-- Quick Dzikir -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“¿ Dzikir Cepat</span>
            <button class="btn btn-sm btn-secondary" onclick="resetDzikir()">Reset</button>
          </div>
          <div class="dzikir-container" style="padding:16px;">
            <div class="dzikir-arabic" id="dzikirArabic" style="font-size:28px;">Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‘Ù°Ù‡Ù</div>
            <div class="dzikir-text" id="dzikirLatin" style="font-size:16px;margin-bottom:16px;">Subhanallah</div>
            <div class="dzikir-tap-area" onclick="incrementDzikir()" style="width:140px;height:140px;">
              <div>
                <div class="dzikir-counter" id="dzikirCount" style="font-size:48px;margin:0;">0</div>
                <div id="dzikirProgress" style="font-size:12px;color:rgba(255,255,255,0.8);">0/33</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:16px;">
              <button class="btn btn-sm" onclick="setDzikir('subhanallah')">Subhanallah</button>
              <button class="btn btn-sm" onclick="setDzikir('alhamdulillah')">Alhamdulillah</button>
              <button class="btn btn-sm" onclick="setDzikir('allahuakbar')">Allahu Akbar</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- TASKS PAGE -->
      <div class="page" id="page-tasks">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
          <h2 style="font-size:18px;font-weight:600;">ğŸ“‹ Tugas</h2>
          <button class="btn btn-primary" onclick="openAddTaskModal()">+ Tambah</button>
        </div>
        <div id="tasksContainer"></div>
      </div>
      
      <!-- POMODORO PAGE -->
      <div class="page" id="page-pomodoro">
        <div class="card">
          <div class="pomodoro-container">
            <!-- Timer Type Selector -->
            <div class="timer-types" id="timerTypes"></div>
            
            <!-- Current Task -->
            <div class="timer-task" id="timerTask" style="display:none;cursor:pointer;" onclick="openPomodoroTaskModal()"></div>
            <button class="btn btn-sm btn-secondary mb-2" onclick="openPomodoroTaskModal()">ğŸ“‹ Pilih Tugas</button>
            
            <!-- Timer Display -->
            <div class="progress-ring">
              <svg width="200" height="200">
                <circle class="progress-ring-bg" cx="100" cy="100" r="90"></circle>
                <circle class="progress-ring-fill" id="timerProgress" cx="100" cy="100" r="90" 
                        stroke-dasharray="565.48" stroke-dashoffset="0"></circle>
              </svg>
              <div class="timer-display" id="timerDisplay">25:00</div>
            </div>
            
            <!-- Controls -->
            <div class="timer-controls">
              <button class="btn btn-primary timer-btn" id="timerStartBtn" onclick="startTimer()">â–¶ï¸ Mulai</button>
              <button class="btn btn-warning timer-btn" id="timerPauseBtn" onclick="pauseTimer()" style="display:none;">â¸ï¸ Pause</button>
              <button class="btn btn-danger timer-btn" id="timerStopBtn" onclick="stopTimer()" style="display:none;">â¹ï¸ Stop</button>
            </div>
            
            <!-- Session Counter -->
            <div style="margin-top:20px;font-size:14px;color:#666;">
              Sesi hari ini: <strong id="sessionCount">0</strong>
            </div>
          </div>
        </div>
      </div>
      
      <!-- REFLEKSI PAGE -->
      <div class="page" id="page-refleksi">
        <h2 style="font-size:18px;font-weight:600;margin-bottom:16px;">ğŸ“Š Refleksi & Stats</h2>
        <div id="refleksiContent"></div>
      </div>
      
      <!-- SETTINGS PAGE -->
      <div class="page" id="page-settings">
        <h2 style="font-size:18px;font-weight:600;margin-bottom:16px;">âš™ï¸ Pengaturan</h2>
        
        <div class="settings-section">
          <div class="settings-title">Notifikasi</div>
          <div class="setting-row" onclick="toggleSetting('notifications')">
            <div class="setting-info">
              <span class="setting-icon">ğŸ””</span>
              <span class="setting-label">Notifikasi</span>
            </div>
            <label class="toggle">
              <input type="checkbox" id="settingNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row" onclick="toggleSetting('sound')">
            <div class="setting-info">
              <span class="setting-icon">ğŸ”Š</span>
              <span class="setting-label">Suara</span>
            </div>
            <label class="toggle">
              <input type="checkbox" id="settingSound" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row" onclick="toggleSetting('vibration')">
            <div class="setting-info">
              <span class="setting-icon">ğŸ“³</span>
              <span class="setting-label">Getaran</span>
            </div>
            <label class="toggle">
              <input type="checkbox" id="settingVibration" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-title">Istirahat Sehat</div>
          <div class="setting-row" onclick="openBreakSettingsModal()">
            <div class="setting-info">
              <span class="setting-icon">ğŸ§˜</span>
              <span class="setting-label">Pengaturan Istirahat</span>
            </div>
            <span>â†’</span>
          </div>
        </div>
        
        <div class="settings-section">
          <div class="settings-title">Data</div>
          <div class="setting-row" onclick="exportData()">
            <div class="setting-info">
              <span class="setting-icon">ğŸ“¤</span>
              <span class="setting-label">Export Data</span>
            </div>
            <span>â†’</span>
          </div>
          <div class="setting-row" onclick="clearAllData()">
            <div class="setting-info">
              <span class="setting-icon">ğŸ—‘ï¸</span>
              <span class="setting-label">Hapus Semua Data</span>
            </div>
            <span style="color:#ef4444;">â†’</span>
          </div>
        </div>
        
        <div class="card" style="text-align:center;margin-top:24px;">
          <div style="font-size:32px;margin-bottom:8px;">ğŸŒ™</div>
          <div style="font-size:14px;font-weight:600;color:#333;">Sync Planner v2.0</div>
          <div style="font-size:12px;color:#888;">Produktivitas Islami dengan Healthy Break</div>
        </div>
      </div>
      
    </main>

    <!-- ============================================ -->
    <!-- BOTTOM NAVIGATION -->
    <!-- ============================================ -->
    <nav class="bottom-nav">
      <button class="nav-item active" data-page="home" onclick="showPage('home')">
        <span class="nav-icon">ğŸ </span>
        <span class="nav-label">Home</span>
      </button>
      <button class="nav-item" data-page="tasks" onclick="showPage('tasks')">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-label">Tugas</span>
      </button>
      <button class="nav-item" data-page="pomodoro" onclick="showPage('pomodoro')">
        <span class="nav-icon">ğŸ…</span>
        <span class="nav-label">Fokus</span>
      </button>
      <button class="nav-item" data-page="refleksi" onclick="showPage('refleksi')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Refleksi</span>
      </button>
      <button class="nav-item" data-page="settings" onclick="showPage('settings')">
        <span class="nav-icon">âš™ï¸</span>
        <span class="nav-label">Setting</span>
      </button>
    </nav>

    <!-- ============================================ -->
    <!-- FLOATING ACTION BUTTON -->
    <!-- ============================================ -->
    <button class="fab" onclick="openAddTaskModal()">+</button>

    <!-- ============================================ -->
    <!-- TOAST NOTIFICATION -->
    <!-- ============================================ -->
    <div id="toast"></div>

    <!-- ============================================ -->
    <!-- MODALS -->
    <!-- ============================================ -->
    
    <!-- Add Task Modal -->
    <div class="modal-overlay" id="addTaskModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">â• Tambah Tugas</h3>
          <button class="modal-close" onclick="closeAddTaskModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Judul Tugas</label>
            <input type="text" class="form-input" id="newTaskTitle" placeholder="Masukkan judul tugas...">
          </div>
          <div class="form-group">
            <label class="form-label">Prioritas</label>
            <select class="form-select" id="newTaskPriority">
              <option value="high">ğŸ”´ Tinggi</option>
              <option value="medium" selected>ğŸŸ¡ Sedang</option>
              <option value="low">ğŸŸ¢ Rendah</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeAddTaskModal()">Batal</button>
          <button class="btn btn-primary" onclick="submitNewTask()">Tambah</button>
        </div>
      </div>
    </div>
    
    <!-- Pomodoro Task Modal -->
    <div class="modal-overlay" id="pomodoroTaskModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">ğŸ“‹ Pilih Tugas Fokus</h3>
          <button class="modal-close" onclick="closePomodoroTaskModal()">Ã—</button>
        </div>
        <div class="modal-body" id="pomodoroTaskList"></div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closePomodoroTaskModal()">Batal</button>
          <button class="btn btn-primary" onclick="confirmCustomPomodoroTask()">Pilih</button>
        </div>
      </div>
    </div>

  </div>

  <!-- ============================================ -->
  <!-- SCRIPTS -->
  <!-- ============================================ -->
  <script src="healthy-break.js"></script>
  <script src="app.js"></script>
  
  <script>
    // Additional utility functions
    function exportData() {
      const data = {
        tasks: JSON.parse(localStorage.getItem('syncPlannerTasks') || '[]'),
        habits: JSON.parse(localStorage.getItem('syncPlannerHabits') || '[]'),
        journals: JSON.parse(localStorage.getItem('syncPlannerJournals') || '[]'),
        settings: JSON.parse(localStorage.getItem('syncPlannerSettings') || '{}'),
        exportedAt: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sync-planner-backup-' + todayString() + '.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('ğŸ“¤ Data berhasil di-export!', 'success');
    }
    
    function clearAllData() {
      if (!confirm('PERINGATAN: Semua data akan dihapus permanen!\n\nLanjutkan?')) return;
      if (!confirm('Apakah Anda yakin? Tindakan ini tidak dapat dibatalkan.')) return;
      
      localStorage.clear();
      showToast('ğŸ—‘ï¸ Semua data dihapus', 'info');
      setTimeout(() => location.reload(), 1000);
    }
    
    // Register Service Worker untuk PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('âœ… Service Worker registered'))
        .catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>
</html>
